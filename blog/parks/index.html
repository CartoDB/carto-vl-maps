<!DOCTYPE html>
<html>
  <head>
    <title>Parks | CARTO</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700|Open+Sans:300,400,600" rel="stylesheet">
    <!-- Include Leaflet -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
    <link href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" rel="stylesheet">
    <!-- Include CARTO.js -->
    <script src="https://libs.cartocdn.com/carto.js/v4.1.11/carto.min.js"></script>
    <link href="https://carto.com/developers/carto-js/examples/maps/public/style.css" rel="stylesheet">
  </head>
  <body>
    <div id="map"></div>
    <aside class="toolbox">
      <div class="box">
        <header>
          <h1>Park Access</h1>
          <button class="github-logo js-source-link"></button>
        </header>
        
        <section>
            <p class="description open-sans">Look for data within your dataset using dropdown menu.</p>
            <ul>
              <li onclick="setCity('New York')">
                <input type="radio" name="source" checked id="newyork">
                <label for ='newyork'>New York</label>

              </li>

              <li onclick="setCity('Chicago')">
                  <input type="radio" name="source" id="Chicago">
                  <label for ='austin'>Chicago</label>
  
                </li>

            </ul>
          </section>
          
        </div>
      </aside>
        
       
        <script>


          const map = L.map('map').setView([40.70979201243498, -73.97781372070314], 10);

              //disable scroll wheel zoom

          map.scrollWheelZoom.disable();

            // cityDrowpDown()

          // populateDrowpDown()

           // add basemap

          L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png', {
          maxZoom: 18
          }).addTo(map);

           // CARTO client

          const client = new carto.Client({
          apiKey: '',
          username: 'mballesteros'

          });
          
          // Insert layer cities
         
          const source = new carto.source.SQL(`SELECT * FROM mballesteros.parksrec WHERE city='New York'`);
          const style = new carto.style.CartoCSS(
            `#layer {
            polygon-fill: ramp([grav1_00], (#d3f2a3, #82d091, #4c9b82, #19696f, #074050), quantiles);}
            #layer::outline {
            line-width: 1;
            line-color: #FFFFFF;
            line-opacity: 0.5;
              }
          `);
          const layer = new carto.layer.Layer(source, style);

          client.addLayer(layer);
          client.getLeafletLayer().addTo(map);

          function setCity(cityName) { 
             source.setQuery (`SELECT * FROM mballesteros.parksrec WHERE city='${cityName}'`);
             console.log(cityName)
          }

          const cities = 
          `SELECT distinct city FROM mballesteros.parksrec`

          function getCities(){
            return fetch(
                `https://cartojs-test.carto.com/api/v2/sql?format=geojson&q=SELECT distinct city FROM mballesteros.parksrec`
                ).then((resp) => resp.json())
                .then((response) => {
                    return response['features'].map(function(feature){
                        option = document.createElement("option")
                        option.setAttribute("value", feature.properties.admin)
                        option.textContent = feature.properties.admin
                        document.getElementById("selectDrop").appendChild(option);
                    });
                }).catch((error) => {
                    console.log(error)
                })
        }








         // Is not taking it because in the example is geojson?

        // function populateDrowpDown(){
        //     return fetch(
        //         `https://team.carto.com/u/mballesteros/dataset/parks`
        //         ).then((resp) => resp.json())
        //         .then((response) => {
        //             return response['features'].map(function(feature){
        //                 option = document.createElement("option")
        //                 option.setAttribute("value", feature.properties.admin)
        //                 option.textContent = feature.properties.admin
        //                 document.getElementById("selectDrop").appendChild(option);
        //             });
        //         }).catch((error) => {
        //             console.log(error)
        //         })
        // }

        // document.getElementById('selectDrop').addEventListener("change", function (e) {
        //     input = e.currentTarget.selectedOptions[0].attributes[0].value;
        //     return  fetch(`https://team.carto.com/u/mballesteros/dataset/parks'${input}'`)
        //     .then((resp) => resp.json())
        //     .then((response) => {
        //         geojsonLayer = L.geoJson(response)
        //         map.fitBounds(geojsonLayer.getBounds());
        //     })
        // });



</script>
